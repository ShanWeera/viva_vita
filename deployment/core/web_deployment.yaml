apiVersion: apps/v1
kind: Deployment
metadata:
  name: viva-vita-backend-deployment
spec:
  selector:
    matchLabels:
      app: viva-vita-backend
  replicas: 1
  template:
    metadata:
      labels:
        app: viva-vita-backend
    spec:
      containers:
        - name: viva-vita-backend
          image: vivabvu.azurecr.io/viva-vita:v2.0.5
          env:
            - name: RABBITMQ_SERVICE_HOST
              value: rabbitmq.vita.svc.cluster.local
            - name: RABBITMQ_USERNAME
              value: user
            - name: RABBITMQ_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: rabbitmq-secret
                  key: rabbitmq-password
            - name: MONGO_DDM_USERNAME
              value: vita
            - name: MONGO_DDM_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mongodb-secret
                  key: mongodb-passwords
            - name: MONGO_DDM_DATABASE
              value: vita
            - name: MONGO_DDM_HOST
              value: mongodb-headless.vita.svc.cluster.local
          imagePullPolicy: IfNotPresent
          command: ["/bin/bash", "-c"]
          args:
            - >-
              poetry run uvicorn wsgi:app --host 0.0.0.0 --port 80
      imagePullSecrets:
        - name: azurecreds
---
apiVersion: v1
kind: Service
metadata:
  name: vita-backend-service
spec:
  selector:
    app: viva-vita-backend
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
---
apiVersion: v1
data:
  tls.crt: QmFnIEF0dHJpYnV0ZXMKICAgIGxvY2FsS2V5SUQ6IDUzIDQyIDA1IDIwIDVDIERCIDA0IEQ2IEE3IEEwIDRCIEM0IDhEIDI2IDk4IDYwIEY1IDExIDc1IDM5IApzdWJqZWN0PS9DPVRSL1NUPVx4QzRceEIwU1RBTkJVTC9MPUZBVFx4QzRceEIwSC9PPUJFWk0tXHhDNFx4QjAgXHhDM1x4ODJMRU0gVkFLSUYgXHhDM1x4OUNOXHhDNFx4QjBWRVJTXHhDNFx4QjBURVNceEM0XHhCMC9DTj0qLmJlem1pYWxlbS5lZHUudHIKaXNzdWVyPS9DPUJFL089R2xvYmFsU2lnbiBudi1zYS9DTj1HbG9iYWxTaWduIFJTQSBPViBTU0wgQ0EgMjAxOAotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJR3NUQ0NCWm1nQXdJQkFnSU1LKzBEandNd3UvMlNQdGVPTUEwR0NTcUdTSWIzRFFFQkN3VUFNRkF4Q3pBSgpCZ05WQkFZVEFrSkZNUmt3RndZRFZRUUtFeEJIYkc5aVlXeFRhV2R1SUc1MkxYTmhNU1l3SkFZRFZRUURFeDFICmJHOWlZV3hUYVdkdUlGSlRRU0JQVmlCVFUwd2dRMEVnTWpBeE9EQWVGdzB5TWpBMk1qUXhOREF4TkRsYUZ3MHkKTXpBM01qWXhOREF4TkRoYU1INHhDekFKQmdOVkJBWVRBbFJTTVJJd0VBWURWUVFJREFuRXNGTlVRVTVDVlV3eApEekFOQmdOVkJBY01Ca1pCVk1Td1NERXRNQ3NHQTFVRUNnd2tRa1ZhVFMzRXNDRERna3hGVFNCV1FVdEpSaURECm5FN0VzRlpGVWxQRXNGUkZVOFN3TVJzd0dRWURWUVFEREJJcUxtSmxlbTFwWVd4bGJTNWxaSFV1ZEhJd2dnRWkKTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDdWx2NzV3QzBaWkYyWUw5cEovV082SUZReQp3R21tUFpHVmh3N0hGb1paTEdBUU5lVm95dnArb045bGRHVU1tUGVJQVRZbGE0eDJkWlRtekdEVVYvYlRTL0lmCm0wdDh0OWdON3VGYmg0bksxejFMLzNOY0ZpMEJlM1VkeXFJWmdyeDdyRXQrSzFITExaMVpETHh5YTZ4NzBBb3QKRm9PbHZ4eWc1OFhTMXhFcXgzWlQ1MDRad2ExZzViMzZUZ1NRQUsrZmw5djhQdXhnTklkNUx5eTdLN21IL1BSNQpSOE9kL29QbFg3TG9GTk90dFppY0tEU0FxRyt3dGVVQXF6bWJPcEFDT3JoVnlWVVFLdVEvTUQrbUNmSHIyZXV5CnBrZUZHRTZ1T29RVmVHZ1Z2WFF0ZFZFeGhrZklLbVB5STZhNU83N0d1Wmp5TVVXdHppUVFDWVA5SGJVQkFnTUIKQUFHamdnTmJNSUlEVnpBT0JnTlZIUThCQWY4RUJBTUNCYUF3Z1k0R0NDc0dBUVVGQndFQkJJR0JNSDh3UkFZSQpLd1lCQlFVSE1BS0dPR2gwZEhBNkx5OXpaV04xY21VdVoyeHZZbUZzYzJsbmJpNWpiMjB2WTJGalpYSjBMMmR6CmNuTmhiM1p6YzJ4allUSXdNVGd1WTNKME1EY0dDQ3NHQVFVRkJ6QUJoaXRvZEhSd09pOHZiMk56Y0M1bmJHOWkKWVd4emFXZHVMbU52YlM5bmMzSnpZVzkyYzNOc1kyRXlNREU0TUZZR0ExVWRJQVJQTUUwd1FRWUpLd1lCQkFHZwpNZ0VVTURRd01nWUlLd1lCQlFVSEFnRVdKbWgwZEhCek9pOHZkM2QzTG1kc2IySmhiSE5wWjI0dVkyOXRMM0psCmNHOXphWFJ2Y25rdk1BZ0dCbWVCREFFQ0FqQUpCZ05WSFJNRUFqQUFNRDhHQTFVZEh3UTRNRFl3TktBeW9EQ0cKTG1oMGRIQTZMeTlqY213dVoyeHZZbUZzYzJsbmJpNWpiMjB2WjNOeWMyRnZkbk56YkdOaE1qQXhPQzVqY213dwpMd1lEVlIwUkJDZ3dKb0lTS2k1aVpYcHRhV0ZzWlcwdVpXUjFMblJ5Z2hCaVpYcHRhV0ZzWlcwdVpXUjFMblJ5Ck1CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFmQmdOVkhTTUVHREFXZ0JUNDczL3kKelhobnFONXZqeVNOaVBHSEF3S3o2ekFkQmdOVkhRNEVGZ1FVU3VVYVNVa01wK1hBbEZTN2hhckJYSlpBN2dndwpnZ0YrQmdvckJnRUVBZFo1QWdRQ0JJSUJiZ1NDQVdvQmFBQjNBT2crME5vKzlRWTFNdWRYS0x5SmE4a0QwOHZSCkVXdnM2Mm5oZDMxdEJyMXVBQUFCZ1pZRTVVSUFBQVFEQUVnd1JnSWhBSjdxWWJUTDQ5enUyODIrWk9iaUt4Zm0KbTQwMVZHY1gyZDZ0NUZBSEt0SjNBaUVBNTg4VnZsU1ErZEZlZWFjUkV3K1I0M29BbHVOeWMwVGR4em5YSWhpQgoyOVlBZFFCdlUzYXNNZkF4R2RpWkFLUlJGZjkzRlJ3UjJRTEJBQ2tHamJJSW1qZlpFd0FBQVlHV0JPR25BQUFFCkF3QkdNRVFDSUhMT3VtU2s4NXVuK0VVTmxZVjA2WmhacXFVYlFua2JjUVd6OUhGN3RKN3FBaUJlNFg2M1NNb0sKc1BLMlhQNUYwUEhmNmg4QVJwL0NMWEpYVEpZdVY3UWxBd0IyQUxOemR3ZmhoRkQ0WTRiV0JhbmNFUWxLZVMyeApad3dMaDl6d0F3NTVOcVdhQUFBQmdaWUU0Y0FBQUFRREFFY3dSUUloQUpkYnQ5NE1RRHRIOHRtNTVQb2Z5VDNkCnV2L29abFRISnFuN01lTnZwcy9mQWlCaVMzYUhOK3NEM1V0anpmUSt6VDNHbUxQMVJXWERwREs4bXZNd1JGYVgKMURBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWJBK0JXc1lmMDBsMzloNEFONkh0K3EyeDV3U2xnYkluTUsySgprN1lUdkxxOUJOalU3UVR1MDBvd29Gb2gxcGNZOXhmNGVsaDVXaUllL3pka2I3M2RLQ09melBTeUNhQkMvOHhZCkRkT1FKNjVOT25pNjVuRDN4TzNURDkyTEJ1UU9sc2dpR3JPcVZqUnNSYkgyQmlsYmE3c0hTYmRpNjlCNEdBbEQKTm1Ga1R4TGpmSVdycGR2RDRjT3RibjJiM1hyZFc0WGh2WGlUeHZDSFhUTUJvWTlHaG1LNzJRbk52SEF6bTVIYwp1SkdmamV6dkhnYkErL29hOUwySXRHSFk1REhCSlpzVmxpbUZtRStLenU3Sk5YWWRIU1Q1N09UYkJJSS9lTTR0CmgzbzI0K3FoTldTOVV4RU14N0lqVitnSnZGbWMrZStvTkZZRTdIbFNWcWJKSlo2ZHlRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBcnBiKytjQXRHV1JkbUMvYVNmMWp1aUJVTXNCcHBqMlJsWWNPeHhhR1dTeGdFRFhsCmFNcjZmcURmWlhSbERKajNpQUUySld1TWRuV1U1c3hnMUZmMjAwdnlINXRMZkxmWURlN2hXNGVKeXRjOVMvOXoKWEJZdEFYdDFIY3FpR1lLOGU2eExmaXRSeXkyZFdReThjbXVzZTlBS0xSYURwYjhjb09mRjB0Y1JLc2QyVStkTwpHY0d0WU9XOStrNEVrQUN2bjVmYi9EN3NZRFNIZVM4c3V5dTVoL3owZVVmRG5mNkQ1Vit5NkJUVHJiV1luQ2cwCmdLaHZzTFhsQUtzNW16cVFBanE0VmNsVkVDcmtQekEvcGdueDY5bnJzcVpIaFJoT3JqcUVGWGhvRmIxMExYVlIKTVlaSHlDcGo4aU9tdVR1K3hybVk4akZGcmM0a0VBbUQvUjIxQVFJREFRQUJBb0lCQVFDaGQ0NmE1c3dPOXM3RQp5RVRuTnd5N2Y5aS9FMHJpYjRDc1BMdEREeWJ6WStINFBCQk9TYU0vNTRLVUx3Q2hsUHNnOHBYa0o4SkJjRjlrCjBOSWdzTFhiRnhyM2RrVnJOQkFDV3RKYk4xQU5vK0RSMzVBT000Z3VIY0xqNlpyZll4VDBnQlZWdTdTcTV5WGwKekt5Z1djcXN1MndkNVB1ZUY5RGZVMXVXc2tiek92cjJhQjB4S1EwaktkdzBVNEc1Z3M2bW1sd2lPMEhneVY2UQpZU0pSaVlPdUk0b1lpL0ZLdGhFbndTTEJ4TnRtRTYwcy83V2h1U1pRZUdvNWpkK2FsMk5ucFo5L0U1alFlUU5HCmxCcjBZc0J4b1JOdE5OQXdkRDc1NHI5SUVOQW9RNVVlRDNzNmpTajVpb0ZrY290d2ZVSThySXVFTGk1bFptTFQKNHZSL21Zdk5Bb0dCQU1BemxIQ2sxcWZLV3B2dHJvK1dxSXpLVTQ0TEJWWGRveG1wOXFINEVxUWZGcmlQK0JYRQpOY3FXK3kzakxYVk1LQnk4RmhEWC96c2RFKzdIeTVGWlFIRzZjbkZWYUZxd1JVYm42ZmhZaHhiUTFxS1A4SDcxClJqd2p5UEUxYTgzQytYSkE0THp4Y21laTN2UXlwVVRHeE51dmZiNXZzSk05ZEpOcDZMbEFNTnQzQW9HQkFPaUsKMjB5ZU1kOVZZSEJSTEkxYVZZVmNYRU1jUHRaa2hBYWJBVTFYMUp2YXV1eDF0cjdVenAzTmNvdFJLTWVjQ0hpeApKNnhNKzdPZ09HV2tiK1Q1bStOM1FaQXd0SnRiNDdDUGJqNm1rWFFjTFNaN3lDRWNENTgzc05PVkYzUFVIY0FKClgrOHFFekYrbXlkeGhuZVgzVEdSQ20xeW5FSVhaWGgyait4VGphRkhBb0dBTERJd0tnN2RoVXZVdGhKYmw0MFAKU1FDbFlmNUt4Y25uWFZsbDZ5eStMSnN4Z0ZNcXV1YVpiL0p6NDhOZmlwOXVnZDBHUGUxTk5XeWtUcjRHbzIrZwprQVpObHA0TEZ2OTlqcVo1ZUsveXNGNXBYSXc0d3hqbmc2Qys3aWhZbDhJRDFpL3cvY0dQaXlFNm4zQ2Q3RWpBCnI3dVU4SnVDUVBsYXV5TVpicS9DREZVQ2dZRUEyNXpQc1JNeG5HNmdEbExMRlkrN2RxQWNUaER0MDBISVlnaWYKZVRDNmpKcE1zQ1lYZVMrM0ZkYkNGNHFGVGNZeFJmSmd1bHRWMW5VNDdkMFhBNU1zUXUwTWtTVStXLzZ6RUxyVQpiZnlYSDZYQWlqaWFiNUoxdW5NNDN3bE54Y2tNYzZFbTVkTEJuNXVtNGVCWUVyZnNZUFJPZWNDa2k5Sld0U2FiCms1L3hBTjhDZ1lCQ1l0c1ZRTG5UU2pnNSticlFDaVEvZzJ5YUpkWHg1b0crSWJxcytTUjFjdlYxeUhwNTJXUmQKN0d6aVpyckdVWFBEdXZleTJZM2RFbnNIUkVMbjhOYjBDQ2RjN3pSZzcrR1BMT1lsOXdqV0FrRkxra2krR2NqMQpzaGplYU9EQlFndXZLaVRtWWhybTdlOFVKM29tWERQOStPRC8zRmozSzFWY2JCT09UMlVIaFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
kind: Secret
metadata:
  name: bvu-tls-cert
type: kubernetes.io/tls
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/proxy-body-size: 100m
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  name: vita-backend
spec:
  rules:
  - host: vita-backend.bezmialem.edu.tr
    http:
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: vita-backend-service
              port:
                number: 80
  tls:
  - hosts:
    - vita-backend.bezmialem.edu.tr
    secretName: bvu-tls-cert